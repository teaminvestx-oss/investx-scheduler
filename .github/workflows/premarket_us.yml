name: InvestX Premarket US (12h Madrid)

on:
  schedule:
    - cron: "0 10 * * 1-5"  # Verano CEST -> 12:00 Madrid
    - cron: "0 11 * * 1-5"  # Invierno CET -> 12:00 Madrid
  workflow_dispatch:

jobs:
  premarket-us:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: System deps
        run: |
          set -e
          sudo apt-get update -y
          sudo apt-get install -y \
            jq curl unzip python3 \
            libatk1.0-0 libatk-bridge2.0-0 libnss3 libx11-6 libx11-xcb1 \
            libxcomposite1 libxdamage1 libxext6 libxfixes3 libxrandr2 \
            libgbm1 libasound2 fonts-liberation ca-certificates

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Puppeteer
        run: npm i puppeteer@22

      - name: Run Premarket Snapshot
        env:
          INVESTX_TOKEN: ${{ secrets.INVESTX_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
          FORCE_SEND: "0"
          GITHUB_EVENT_NAME: ${{ github.event_name }}
        run: node premarket_futures.js
