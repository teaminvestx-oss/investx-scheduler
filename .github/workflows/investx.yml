name: InvestX Telegram Scheduler

on:
  schedule:
    - cron: "0 7 * * *"     # 09:00 Madrid
    - cron: "0 19 * * *"    # 21:00 Madrid
    - cron: "0 20 * * 1-5"  # 22:00 Madrid (L-V)
  workflow_dispatch:

jobs:
  send-0900:
    if: github.event_name == 'schedule' && github.event.schedule == '0 7 * * *'
    runs-on: ubuntu-latest
    steps:
      - name: Send 09:00 (Madrid)
        env:
          BOT_TOKEN: ${{ secrets.INVESTX_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          TEXTO="üìä ¬°Buenos d√≠as equipo! Vamos a por los setups de hoy en InvestX."
          curl -s "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" \
            -d parse_mode="HTML" \
            --data-urlencode text="${TEXTO}"

  send-2100:
    if: github.event_name == 'schedule' && github.event.schedule == '0 19 * * *'
    runs-on: ubuntu-latest
    steps:
      - name: Send 21:00 (Madrid)
        env:
          BOT_TOKEN: ${{ secrets.INVESTX_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          TEXTO="üîî 21:00 ‚Äî Veamos c√≥mo cierra hoy el d√≠a para revisar los setups en InvestX."
          curl -s "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" \
            -d parse_mode="HTML" \
            --data-urlencode text="${TEXTO}"

  send-2200:
    if: github.event_name == 'schedule' && github.event.schedule == '0 20 * * 1-5'
    runs-on: ubuntu-latest
    steps:
      - name: Send 22:00 (Madrid, L-V)
        env:
          BOT_TOKEN: ${{ secrets.INVESTX_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          TEXTO="üõéÔ∏è Mercado cerrado equipo, empezamos desde ya a revisar setups. Como siempre volatilidad al final del mercado üîç"
          curl -s "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" \
            -d parse_mode="HTML" \
            --data-urlencode text="${TEXTO}"

  test:
    if: github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Send custom test message
        env:
          BOT_TOKEN: ${{ secrets.INVESTX_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          curl -s "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" \
            -d parse_mode="HTML" \
            --data-urlencode text="‚ö°Ô∏è Test r√°pido enviado manualmente desde GitHub Actions üöÄ"
