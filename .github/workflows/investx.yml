name: InvestX Telegram Scheduler

on:
  schedule:
    - cron: "0 7 * * 1-5"     # 09:00 Madrid (L-V)
    - cron: "0 19 * * 1-5"    # 21:00 Madrid (L-V)
    - cron: "0 20 * * 1-5"    # 22:00 Madrid (L-V)
  workflow_dispatch:


jobs:
  diag:
    # Este job SIEMPRE corre en cada cron para auditar el disparo
    runs-on: ubuntu-latest
    steps:
      - name: Print event info
        run: |
          echo "event_name=${{ github.event_name }}"
          echo "event.schedule=${{ github.event.schedule }}"
          echo "now_utc=$(date -u +'%Y-%m-%d %H:%M:%S UTC')"
          echo "now_madrid=$(TZ=Europe/Madrid date +'%Y-%m-%d %H:%M:%S %Z')"

      # Si quieres ver en el canal cu√°ndo se dispara el cron, descomenta esto:
      # - name: Ping (debug)
      #   env:
      #     BOT_TOKEN: ${{ secrets.INVESTX_TOKEN }}
      #     CHAT_ID: ${{ secrets.CHAT_ID }}
      #   run: |
      #     MSG="üõ†Ô∏è Debug cron ‚Äî schedule='${{ github.event.schedule }}' | UTC=$(date -u +'%H:%M') | Madrid=$(TZ=Europe/Madrid date +'%H:%M')"
      #     curl -s "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
      #       -d chat_id="${CHAT_ID}" -d parse_mode="HTML" --data-urlencode text="${MSG}"

  send-0900:
    if: github.event_name == 'schedule' && github.event.schedule == '0 7 * * *'
    runs-on: ubuntu-latest
    steps:
      - name: Send 09:00 (Madrid)
        env:
          BOT_TOKEN: ${{ secrets.INVESTX_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          TEXTO="üìä ¬°Buenos d√≠as equipo! Vamos a por los setups de hoy en InvestX."
          curl -sS "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" -d parse_mode="HTML" --data-urlencode text="${TEXTO}"

  send-2100:
    if: github.event_name == 'schedule' && github.event.schedule == '0 19 * * *'
    runs-on: ubuntu-latest
    steps:
      - name: Send 21:00 (Madrid)
        env:
          BOT_TOKEN: ${{ secrets.INVESTX_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          TEXTO="üîî 21:00 ‚Äî Veamos c√≥mo cierra hoy el d√≠a para revisar los setups en InvestX."
          curl -sS "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" -d parse_mode="HTML" --data-urlencode text="${TEXTO}"

  send-2200:
    if: github.event_name == 'schedule' && github.event.schedule == '0 20 * * 1-5'
    runs-on: ubuntu-latest
    steps:
      - name: Send 22:00 (Madrid, L-V)
        env:
          BOT_TOKEN: ${{ secrets.INVESTX_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          TEXTO="üõéÔ∏è Mercado cerrado equipo, empezamos desde ya a revisar setups. Como siempre, volatilidad al final del mercado üîç"
          curl -sS "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" -d parse_mode="HTML" --data-urlencode text="${TEXTO}"
