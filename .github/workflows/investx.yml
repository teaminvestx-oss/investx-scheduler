name: InvestX Telegram Scheduler

on:
  schedule:
    - cron: "0 7 * * 1-5"      # 09:00 Madrid (L-V) -> 07:00 UTC
    - cron: "30 8 * * 1-5"     # 10:30 Madrid (L-V) -> 08:30 UTC
    - cron: "0 19 * * 1-5"     # 21:00 Madrid (L-V) -> 19:00 UTC
    - cron: "0 20 * * 1-5"     # 22:00 Madrid (L-V) -> 20:00 UTC
  workflow_dispatch:

jobs:
  diag:
    runs-on: ubuntu-latest
    steps:
      - name: Print event info
        run: |
          echo "event_name=${{ github.event_name }}"
          echo "event.schedule=${{ github.event.schedule }}"
          echo "now_utc=$(date -u +'%Y-%m-%d %H:%M:%S UTC')"
          echo "now_madrid=$(TZ=Europe/Madrid date +'%Y-%m-%d %H:%M:%S %Z')"

  send-0900:
    if: github.event_name == 'schedule' && github.event.schedule == '0 7 * * 1-5'
    runs-on: ubuntu-latest
    steps:
      - name: Send 09:00 (Madrid, L-V)
        env:
          BOT_TOKEN: ${{ secrets.INVESTX_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          TEXTO="ğŸŒ Â¡Buenos dÃ­as, equipo!Arrancamos la jornada en InvestX con energÃ­a ğŸ’¥.Hoy os esperan setups claros, niveles clave y oportunidades de mercado para no dejar escapar. ğŸš€"
          curl -sS "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" -d parse_mode="HTML" --data-urlencode text="${TEXTO}"

  send-1030:
    if: github.event_name == 'schedule' && github.event.schedule == '30 8 * * 1-5'
    runs-on: ubuntu-latest
    steps:
      - name: Send 10:30 (Madrid, L-V)
        env:
          BOT_TOKEN: ${{ secrets.INVESTX_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          TEXTO="ğŸ“Œ TIP DEL DÃA-Â¿SabÃ­as que si pulsas el ticker con \"#\" delante en el canal ğŸ“² podrÃ¡s ver al instante todas las menciones, informes y noticias de ese activo?Â¡AprovÃ©chalo para no perder contexto ni oportunidades! ğŸ”"
          curl -sS "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" -d parse_mode="HTML" --data-urlencode text="${TEXTO}"

  send-2100:
    if: github.event_name == 'schedule' && github.event.schedule == '0 19 * * 1-5'
    runs-on: ubuntu-latest
    steps:
      - name: Send 21:00 (Madrid, L-V)
        env:
          BOT_TOKEN: ${{ secrets.INVESTX_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          TEXTO="ğŸ”” 21:00 â€” Ãšltima hora del mercado ğŸ“‰ğŸ“ˆEs el momento de revisar cÃ³mo cierra la sesiÃ³n y quÃ© setups siguen vivos.ğŸ‘€ Preparad la lupa, porque aquÃ­ es donde aparecen las pistas para maÃ±ana."
          curl -sS "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" -d parse_mode="HTML" --data-urlencode text="${TEXTO}"

  send-2200:
    if: github.event_name == 'schedule' && github.event.schedule == '0 20 * * 1-5'
    runs-on: ubuntu-latest
    steps:
      - name: Send 22:00 (Madrid, L-V)
        env:
          BOT_TOKEN: ${{ secrets.INVESTX_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          TEXTO="ğŸŒ™ El mercado ya ha cerrado, equipo.Ahora toca revisar con calma los movimientos finales de la sesiÃ³n y preparar el terreno para maÃ±ana ğŸ“.ğŸ’¡ La volatilidad al cierre siempre deja oportunidades escondidas... Â¡no las dejemos pasar!"
          curl -sS "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" -d parse_mode="HTML" --data-urlencode text="${TEXTO}"
