name: InvestX Telegram Scheduler

on:
  schedule:
    # GitHub usa UTC; Madrid = UTC+2 en verano
    - cron: '0 7 * * *'   # 09:00 Madrid
    - cron: '0 19 * * *'  # 21:00 Madrid
    - cron: '0 20 * * 1-5' # 22:00 Madrid (L-V)
  workflow_dispatch:

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Pick message
        id: pick
        run: |
          H=$(date -u +%H:%M)
          if [ "$H" = "07:00" ]; then
            echo "msg=ðŸ“Š Â¡Buenos dÃ­as equipo! Vamos a por los setups de hoy en InvestX." >> $GITHUB_OUTPUT
          elif [ "$H" = "19:00" ]; then
            echo "msg=ðŸ”” 21:00 â€” Veamos cÃ³mo cierra hoy el dÃ­a para revisar los setups en InvestX." >> $GITHUB_OUTPUT
          else
            echo "msg=ðŸ›Žï¸ Mercado cerrado equipo, empezamos desde ya a revisar setups ðŸ”" >> $GITHUB_OUTPUT
          fi
      - name: Send Telegram message
        env:
          BOT_TOKEN: ${{ secrets.INVESTX_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
          TEXT: ${{ steps.pick.outputs.msg }}
        run: |
          curl -s "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" \
            -d parse_mode="HTML" \
            --data-urlencode text="${TEXT}"
